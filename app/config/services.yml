services:
    wolnosciowiec.api.deployer.handler:
        class: AppBundle\Service\Deployer\DeployHandler
        arguments:
            branchMatcher: "@wolnosciowiec.api.heroku.branch_matcher"

    wolnosciowiec.api.deployer.handler.heroku:
        class: AppBundle\Service\Deployer\Method\HerokuMethod
        arguments:
            fetcher: "@wolnosciowiec.api.heroku.fetcher"
            client: "@wolnosciowiec.api.heroku.client"
        tags:
            - { name: deployer }

    wolnosciowiec.api.deployer.handler.thin_deployer:
        class: AppBundle\Service\Deployer\Method\ThinDeployerMethod
        arguments:
            client: "@libraries.guzzlehttp.client"
        tags:
            - { name: deployer }

    wolnosciowiec.api.heroku.fetcher:
        class: AppBundle\Service\Fetcher\GitFetcher
        arguments:
            wrapper: "@libraries.git"
            repositoriesStoragePath: "%storage_path%"
            repositoriesOverridePath: "%storage_override_path%"

    wolnosciowiec.api.heroku.client:
        class: AppBundle\Service\TargetPreparation\HerokuClient

    wolnosciowiec.api.heroku.branch_matcher:
        class: AppBundle\Service\BranchMatcher

    wolnosciowiec.api.heroku.exception_controller:
        class: AppBundle\Controller\ExceptionController
        arguments:
            - "@twig"
            - "%kernel.debug%"

    libraries.git:
        class: GitWrapper\GitWrapper
        shared: false

    libraries.guzzlehttp.client:
        class: GuzzleHttp\Client
        shared: false


